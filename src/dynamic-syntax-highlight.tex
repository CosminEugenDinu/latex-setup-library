\documentclass[12pt]{article}
\usepackage[a5paper,margin=5mm,bottom=15mm]{geometry}
\usepackage{fontspec}
\setmainfont{Segoe UI}

\begin{document}
\newcommand{\cod}[1]{}

Dynamic syntax highlighting. \\

\newcommand{\code}[2][]{
    % input require compile flag -shell-escape
    \fontspec{Consolas}
    \input{|../lib/syntax-highlight/syntax_highlight.py #1 '../src/dynamic-syntax-highlight.tex'}
}

****** First python snippet: *****
\small
\code['Hello World Program.py']{
def _get_definition(language, lang_definition):
    if language == 'py': return lang_definition.py
    if language == 'js': return lang_definition.js
}{}

***** Second python snippet: *****
\small
\code[snip.py]{
def highlight(words, language, theme):
    if language == 'py': lang_theme = theme.py
    if language == 'js': lang_theme = theme.js

    highlighted_words = []
    for word, typ in words:
        latex_escaped = [] 
        for char in word:
            latex_escaped.append(theme.latex_escape.get(char, char))
        highlighted_words.append(lang_theme[typ] % ''.join(latex_escaped))
    return ''.join(highlighted_words)
}{}

\end{document}